# Project Overview for AI Agents

This project provides an easy-to-use OpenVPN server that runs within a Docker container. The primary goal is to simplify the setup and management of a VPN server.

## Architecture

The system is designed using a multi-container Docker setup orchestrated by `compose.yaml`. The key components are:

*   **`Dockerfile`**: This file defines the base image (`debian:bookworm-slim`) and installs the necessary packages, including `openvpn`, `iptables`, `gettext`, and `dumb-init`. It also sets up the environment variables and copies the required scripts for initialization and startup.

*   **`compose.yaml`**: This file defines three services:
    *   `config`: This service is responsible for initializing the VPN configuration, including generating certificates and keys. It runs the `/init-vpn.sh` script and then exits.
    *   `tcp`: This service runs the OpenVPN server on the TCP port. It depends on the successful completion of the `config` service.
    *   `udp`: This service runs the OpenVPN server on the UDP port, sharing the same configuration as the `tcp` service.

*   **`.env`**: This file contains the environment variables for configuring the VPN, such as the Common Names (CN) for the Certificate Authority (CA), the VPN server, and the client. It also allows for customization of the Docker image and other parameters.

## Core Scripts

The core logic of the VPN setup and operation is contained within several shell scripts. These are executed by the Docker containers to initialize, start, and manage the VPN.

*   **`/init-vpn.sh`**: This is the primary initialization script, run by the `config` service. Its main responsibilities are:
    *   Generating the Certificate Authority (CA) key and certificate.
    *   Creating the server's private key and certificate, signed by the CA.
    *   Generating Diffie-Hellman parameters and a TLS-Auth key for security.
    *   Creating an initial client key and certificate.
    *   Templating and creating the final OpenVPN server configuration files (`tcp-server.conf`, `udp-server.conf`) and the client `.ovpn` profiles using environment variables.

*   **`/start-vpn.sh`**: This script is the entrypoint for the `tcp` and `udp` services. It:
    *   Verifies the server certificate against the CA.
    *   Sets up `iptables` rules to handle network traffic routing for the VPN.
    *   Starts the OpenVPN process using the appropriate server configuration file (`tcp-server.conf` or `udp-server.conf`).

*   **`/check-serial.sh`**: This is a helper script used for security. It's called by OpenVPN to verify that the serial number of a connecting client's certificate is valid and registered, preventing unauthorized access.

*   **`/log.sh`**: A utility script for debugging purposes. It logs environment variables and other connection details to a file.

## How it works

1.  **Initialization**: When `docker compose up` is executed for the first time, the `config` service runs the `/init-vpn.sh` script. This script generates the necessary certificates and keys for the CA, the server, and a default client.
2.  **VPN Server**: Once the configuration is generated, the `tcp` and `udp` services start the OpenVPN server, listening on their respective ports.
3.  **Client Configuration**: The client configuration files (`.ovpn`) are generated and stored in the `conf/clients` directory, which is mounted as a volume. These files can then be used with any OpenVPN-compatible client to connect to the server.

The project is designed to be highly customizable through the `.env` file, allowing users to specify their own domain names and other VPN parameters.

<!-- This file was initially generated by the AI agent gemini-2.5-pro to help other agents understand the project. -->
